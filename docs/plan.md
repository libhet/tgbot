# План разработки Telegram мини-приложения для изучения языков

Ниже приведены ключевые рабочие блоки и последовательность шагов для реализации требуемого функционала. Все компоненты должны быть подготовлены с учётом развёртывания на Heroku.

## 1. Подсистема загрузки и парсинга материалов + генерация упражнений
1. Определить модель данных для заметок/источников (`notes`, `source_type`, `metadata`) и таблицу для упражнений в БД.
2. Реализовать сервисы импорта: парсинг текста из PDF (например, `pdfplumber`), извлечение контента из ссылок (Notion API/Web scraping), OCR для изображений/скриншотов (`pytesseract`), загрузка сырых текстовых заметок.
3. Создать пайплайн обработки текста: очистка, языковое определение, токенизация, выделение словарных единиц.
4. Разработать генератор упражнений, формирующий протоколы вида:
   ```
   type: move_words
   words: word1 word2 ...
   exercise_start
   1. There is a __, it can be __
   2. ...
   exercise_end
   ```
   и вариант `type: recall_words`.
5. Сохранить упражнения в БД, обеспечив хранение метаданных (уровень сложности, дата создания, связанная заметка).
6. Покрыть сервисы юнит-тестами и интеграционными сценариями на примерах (PDF, Notion, изображение).

## 2. Отображение списка/календаря упражнений и интерфейс выбора
1. Определить API эндпоинты бэкенда для выдачи упражнений списком и календарём (фильтры по дате/статусу/типу).
2. Реализовать хранилище расписания (`practice_sessions`) с датами и связью с упражнениями.
3. В интерфейсе мини-аппы создать экран со списком упражнений и календарный вид (inline-календарь Telegram или кастомный UI) для планирования.
4. Добавить обработчики команд/кнопок Telegram для переключения между представлениями.
5. Написать тесты API и UI-скриптов (моки Telegram).

## 3. Планирование повторений по кривой забывания и управление расписанием
1. Имплементировать модуль планирования (Spaced Repetition): генерация дат повторений (1 день, 3 дня, 7 дней и т.д.) с возможностью конфигурирования.
2. Настроить CRUD API для расписаний: просмотр, перенос, отмена, добавление вручную.
3. Добавить UI для управления планом (кнопки «Перенести», «Добавить повтор»).
4. Хранить историю повторений и пересчитывать будущие даты в зависимости от успеха пользователя.
5. Написать автоматические тесты алгоритма и интеграционные тесты API.

## 4. Интерфейсы выполнения упражнений (перетаскивание/нажатие, ввод текста)
1. Определить формат хранения «сессии выполнения» (старт, статус, ответы пользователя).
2. Для типа `move_words` реализовать механику выбора слова из «облака» и вставки в пропуск (кнопки/inline-keyboard, drag-like UX).
3. Для типа `recall_words` реализовать форму ввода текста, проверку правильности (учёт регистра, альтернативных ответов).
4. Обновлять прогресс в реальном времени; показывать фидбек (правильно/ошибка, подсказки).
5. Протестировать UI-сценарии с использованием Telegram test API/моков.

## 5. Дополнительные типы упражнений
1. Разработать генераторы заданий: составление предложений по теме, ответы на вопросы по тексту, альтернативные форматы (множественный выбор, верно/неверно).
2. Добавить новый протокол хранения (типы `compose_sentence`, `answer_question` и т.п.).
3. Расширить UI выполнения (формы ответов, проверка, подсказки).
4. Обновить планировщик, чтобы учитывать новые типы упражнений.
5. Написать тесты генерации и проверки ответов.

## 6. Трекинг прогресса, статусы повторов, завершение
1. Создать сущности для статуса упражнения (например, `pending`, `in_progress`, `completed`) и счётчика повторов.
2. Добавить UI/команды для отметки прохождения (чекбоксы/кнопки «Повтор #1», «Повтор #2» и т.п.).
3. Визуализировать прогресс в списке/календаре (бейджи, цветовая кодировка).
4. Хранить историю, чтобы при достижении нужного количества повторов упражнение переходило в «выполненные».
5. Реализовать отчётность (статистика по неделе/месяцу).

## 7. Уведомления и напоминания в Telegram
1. Настроить планировщик/джоб-раннер (APScheduler, Celery) для периодического опроса расписания повторов.
2. Реализовать отправку уведомлений пользователям через Telegram Bot API (персональные сообщения, напоминания в чатах).
3. Предусмотреть snooze/перенос прямо из уведомления (inline-кнопки).
4. Добавить настройку частоты и «тихих часов».
5. Покрыть модуль уведомлений интеграционными тестами (моки Telegram).

## 8. Инфраструктура, безопасность, локализация
1. Настроить окружение: Docker, CI/CD, переменные окружения (API-ключи Telegram, OCR сервисов и пр.).
2. Реализовать авторизацию/аутентификацию пользователей (Telegram user IDs, привязка к аккаунтам).
3. Добавить локализацию интерфейса (RU/EN и др.).
4. Обеспечить логирование, мониторинг, бэкап данных.
5. Документировать API и рабочие процессы (README/архитектура).

## 9. Развёртывание и эксплуатация на Heroku
1. Подготовить Procfile и конфигурацию buildpacks (Python/Node.js при необходимости) для Telegram мини-приложения.
2. Определить переменные окружения Heroku (токен бота, ключи для OCR, БД) и настроить автоматическое управление секретами.
3. Настроить базу данных (Heroku Postgres) и внешние хранилища (например, S3-совместимые сервисы для файлов), обеспечить миграции.
4. Реализовать CI/CD-пайплайн с автодеплоем на Heroku (GitHub Actions/Heroku pipelines).
5. Настроить мониторинг Heroku (логирование, алерты), а также регулярные бэкапы и план обслуживания.
